# Java内存分区

[toc]



## 前言

Java代码被编译为字节码以后，经过类加载器被加载到jvm中运行。



## 堆

堆：存放数组对象、实例对象（包含非静态成员变量）、字符串常量池，它是线程共享的内存区域。

有时候new出来的对象也会放到栈区，尤其是该对象的作用域没有逃逸出函数体。



## 虚拟机栈

存放当前线程执行方法时的**局部变量**、操作数栈、动态链接、方法出口等信息。

每个线程运行时需要的内存，叫做虚拟机栈。它是线程私有的。

JVM的垃圾回收不涉及到栈内存。

方法中的局部变量是线程安全的吗？

- 如果局部变量没有逃逸方法的作用域，则它是线程安全的。
- 如果局部变量的引用逃离了方法作用域，则不是线程安全的。



## 程序计数器

存放**当前线程**的下一条JVM指令。它是一块非常小的内存空间，在任何一个时刻，一个CPU只会执行一个线程的指令，因此它是**线程私有**的，线程切换后能够恢复到正确的执行位置。



## 本地方法栈

存放C/C++代码。线程私有。



## 元空间

Java8及以后，方法区被元空间替换，存放运行时常量池、静态变量、类对象等，它是线程共享的内存区域。

同时，**元空间不属于JVM**，而属于本地内存。



# 总结

线程私有：虚拟机栈、本地方法栈、程序计数器。

线程共享：堆区、元空间（不在JVM中）。
