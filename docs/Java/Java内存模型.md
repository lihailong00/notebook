# Java内存模型

[toc]



## 是什么

Java内存模型（JMM）是一种虚拟机规范，定义了Java虚拟机与计算机内存是如何协同工作的，实现让Java程序在各种平台下都能达到一致的并发效果



## 硬件内存架构

现代硬件内存模型与Java内存模型有一些不同，理解内存模型架构以及Java内存模型如何与它协同工作也是非常重要的。

**多CPU**：一个现代计算机通常由两个或者多个CPU。其中一些CPU还有多核。从这一点可以看出，在一个有两个或者多个CPU的现代计算机上同时运行多个线程是可能的。每个CPU在某一时刻运行一个线程是没有问题的。这意味着，如果你的Java程序是多线程的，在你的Java程序中每个CPU上一个线程可能同时（并发）执行。





> 缓存一致性问题

多处理器中，每个处理器都有自己的高速缓存，同时这些处理器共享主存。当多个处理器操作同一片内存空间时，各自的缓存数据可能不一样，那么该以哪个CPU的缓存为准呢？这就是缓存一致性问题。



> 指令重排问题

处理器为了充分利用内部的运算单元，能会对输入代码进行乱序执行优化。Java虚拟机也采用类似的**乱序重排优化**。这就产生了一个问题：在多线程编程中，如果一个计算任务依赖另一个计算任务的中间过程，那么乱序重排后可能会出问题。



## Java内存模型和硬件内存架构之间的桥接

对于硬件，所有的线程栈和堆都分布在主内存中。部分线程栈和堆可能有时候会出现在CPU缓存中和CPU内部的寄存器中。
