# bean的生命周期

[toc]



## 扫描bean类

使用xml、注解扫描等方式找到bean类，并将bean相关信息放入`beanDefinationMap`中，其中key为beanName，value为beanDefination。



## 生产bean

遍历`beanDefinationMap`，创建bean对象。创建bean对象大致有以下几步：构造对象、填充属性、初始化实例、注册销毁。

1. 构造对象：
2. 填充属性：
3. 初始化实例：
4. 注册销毁：



### 实例化

正常编程中，我们实例化一个对象只需要new一个对象，并调用适当的构造方法即可。

```java
Person p1 = new Person();
Person p2 = new Person("晓龙", 8);
```

**在IOC容器中，我们需要通过反射机制，获取bean类的构造方法。然后创建对象。**

获取构造方法的策略如下：

1. 如果bean只有一个构造方法，则取这个构造方法。
2. 如果bean中有多个构造方法，则先拿带有`@Autowired`的构造方法。（不能用`@Resource`）
3. 如果有多个`@Autowired`构造方法，则报错。
4. 如果构造方法都没有`@Autowired`，则优先拿无参构造方法。
5. 如果只有多个不同的有参构造方法，则报错。

不建议在一个bean类中添加多个构造方法。



获取构造方法后，如果构造方法的参数列表有bean对象，会按照以下规则在单例池中查找bean对象：

1. 根据**参数的类型**在单例池中查找bean对象。
2. 若单例池中有多个相同类型的bean对象，则根据**参数名**匹配查找bean对象。
3. 如果还没找到，则构造信息不完整，会报错。



此时我们有了bean的构造函数+构造函数的参数对象，就可以通过**反射**构造bean对象了。



### 填充属性

构造好bean对象后，需要填充属性。主要填充标有`@Autowired`或`@Resource`的属性。

填充时如果出现循环依赖的情况，需要借助三级缓存。（不建议出现循环依赖）



### 初始化实例

**初始化**主要设置或获取IOC容器的各种参数，例如各种beanName，beanFactory......

bean类如果`implements`各种`Aware`接口，就能感知到IOC容器中的信息。



### 注册销毁

无



## 使用bean



## 销毁bean

