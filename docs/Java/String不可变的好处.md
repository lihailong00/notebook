# String不可变性

[toc]



## 什么是不可变

有些同学认为String是可变的，并且给出了代码。

```java
String str = "abc";
str = "def";
```

`str`由`abc`变为`def`，这不就可变了吗？不是这样的！

**可变是指修改原始字符串，而上述案例中，引用`str`先指向`abc`，再指向`def`。**



## String为什么被设计为不可变

当我们使用`String str = "abc"`时，Java会检查常量池中是否有常量值为`abc`的常量。如果没有，则会在常量池中创建一个常量对象，并让`str`指向该常量对象。

让`str`指向的常量的好处在于：

1. **节省空间**：`String s1 = "abc"; String s2 = "abc";`s1和s2指向常量池中同一个常量。
2. **缓存哈希**：哈希值应该具有不可变性。通过`str`指向的字符串常量计算出哈希值后，由于字符串常量不可变，因此第一次计算出的哈希值也永远不会变，这样就可以缓存哈希值。
