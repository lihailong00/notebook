# MySQL 事务

参考文章：

[MySQL事务隔离级别和实现原理](https://zhuanlan.zhihu.com/p/117476959)



问题：

1. 事务是什么？

   答案：**数据库事务**是指一系列操作的集合。事务要么成功，要么失败。假定对于”取钱事务“，其中包含5个操作。那么这5个操作要么**全部成功**，要么**全部失败**。

2. 事务的四大特性（`ACID`）是什么？

   1. 原子性（Atomicity）：事务是最小的执行单元。

   2. 一致性（Consistency）：系统从一个正确的状态，变为另一个正确的状态。比如转账的过程中，转账双方的总金额固定，一方都到100元，另一方就得支出100元。

   3. 隔离性（Isolation）：事务之间相互不干扰。

   4. 持久性（Durability）：一旦事务提交，所做的修改将永远保存在数据库中。

3. 事务隔离是什么？

   答案：举个例子。存钱和取钱分别是一个事务。两个事务在同时执行的时候，我们要采用一定的隔离措施，也即人为安排如何同时执行两个事务。

4. 事务的隔离有哪几个级别？每个隔离级别分别解决了什么问题？

   | 隔离级别 | 脏读 | 不可重复读 | 幻读 |
   | -------- | ---- | ---------- | ---- |
   | 读未提交 | ✘    | ✘          | ✘    |
   | 读已提交 | ✔    | ✘          | ✘    |
   | 可重复读 | ✔    | ✔          | ✘    |
   | 串行化   | ✔    | ✔          | ✔    |

   

5. 什么是脏读、不可重复读、幻读？（假定有事务A和事务B，属性money = 1000）

   答案：

   1. 脏读是指事务A操作`money = money - 300`，但是并未commit。这时事务B恰好读取到的结果是`money = 700`。脏读的风险在于事务A一旦做rollback操作，那么`money = 1000`。一句话：**脏读就是事务A读取了事务B修改但并未提交的数据。**
   2. 不可重复读是指事务A第一次查询`money = 1000`，接着事务B中操作`money = money - 300`，并且commit。此时事务A中再次查询的结果是`money = 700`。**由于事务具有原子性，因此事务A在commit之前的任何时间查询相同记录都要得到相同的值。**一句话：**不可重复读是指在并发更新时，事务A前后查询相同数据时的前后不一致。**
   3. 幻读：事务A按照一定条件读取数据，期间事务B插入了相同搜索条件的新数据。事务A再次按照原先条件读取数据，发现了事务B产生的新数据，一句话：**事务A在多次查询过程中，数据条数不一致。**

6. 什么是【串行化】？

   假定有事务A, B, C, D, E, F。A查询，B查询，C修改，D查询，E修改，F查询。刚开始直接执行A, B。C未执行，则会阻塞后面的所有事务。A,Bcommit后执行C，然后执行D。当E未执行时，会阻塞F。当Ecommit后，执行F。

7. 读锁(S锁)和写锁(X锁)分别是什么？

8. 行锁和表锁分别是什么？

