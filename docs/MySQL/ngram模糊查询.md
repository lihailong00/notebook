# ngram模糊查询

[toc]

## 是什么

从MySQL 5.7.6开始，MySQL内置了ngram全文解析器，支持中文、日文、韩文全文索引。

用ngram全文解析器对“生日快乐”进行分词。

```
n=1: '生', '日', '快', '乐' 
n=2: '生日', '日快', '快乐' 
n=3: '生日快', '日快乐' 
n=4: '生日快乐'
```

假定我们搜索“你生日是”这四个字，数据库中的一条数据包含“生日快乐”子串。

ngram会将我们搜索的字分成：`你生`、`生日`、`日是`；同时也会将数据库中的数据分成`生日`、`日快`、`快乐`。可以看出，`生日`关键字匹配，所以命中目标。



## 怎么做

1. 找到MySQL的配置文件`my.ini`，千万别找错！

2. 添加如下配置：

   ```ini
   # 全文检索分词数
   ngram_token_size=2
   ```

   注：假定数据库中有”生日快乐“四个字，我们搜索”生日“，全文检索分词数是3，那么无法命中目标！

3. 给相应的字段添加**全文索引**，注意分析器要填**ngram**。

   ![QQ截图20230204140715](https://figurebed-1309161819.cos.ap-nanjing.myqcloud.com/typora/QQ%E6%88%AA%E5%9B%BE20230204140715.png)



4. 输入查询语句：

   ```sql
   SELECT * FROM `user` WHERE MATCH(content) against('数学');
   ```



重要建议：

1. 如果针对两个字段建立全文索引，sql语句中只MATCH了一个字段，则会报错，所以建议针对单个字段建立全文索引。
1. WHERE 条件中**只能用等号**；**不要用ORDER BY**。