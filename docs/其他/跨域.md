# 跨域

[toc]

## 写在前面

网上关于跨域的文章讲的很不清楚，我目前也没完全搞懂。不懂的地方如下。



## 同源策略

最初，它的含义是指，A 网页设置的 Cookie，B 网页不能打开，除非这两个网页“同源”。所谓“同源”指的是“三个相同”：协议相同、域名相同、端口相同。

如果非同源，共有三种行为受到限制：

- Cookie、LocalStorage 和 IndexDB 无法读取
- DOM 无法获得
- **AJAX 请求不能发送**



## 什么是跨域

跨域是**浏览器**为了安全而建立的一个机制，用于限制**JS**。

假定我在`www.baidu.com`的站点下**通过JS访问**`www.google.com`，此时就发生了跨域。如果直接在网址栏输入`www.google.com`或者通过a标签跳转到`www.google.com`，则不会发送跨域。

回到前后端开发中，我们时常会遇到跨域的问题，原因是这样的：假定前端的站点是`http://localhost:5173`，后端的站点是`http://localhost:8080`，由于他们不“同源”，因此发生了跨域问题。默认情况下，后端服务器请求不会正常响应。

浏览器会先检查发送的请求是否属于跨域请求。如果是，浏览器自动在请求头中强制添加`Origin`字段。

思考：如果我不通过浏览器，而是通过apifox或curl这样的工具发请求，会发生跨域问题吗？

答案：不会。通过它们访问后端服务器，相当于网址栏直接输地址。



## 实现细节

浏览器自动添加Origin。



## 一些问题

A：为什么我访问`www.baidu.com`不会发生跨域问题？

Q：跨域仅针对`js`，也即跨域只会限制`ajax`或`axios`。



## 如何解决跨域

1. 后端服务器配置允许跨域。

2. 前端将后端需要的请求发送给NGINX服务器（页面与NGINX同源，浏览器不会携带跨域标志），然后让NGINX转发给后端。

   这里NGINX承担了两份工作：一是返回前端资源，二是转发请求给后端资源。